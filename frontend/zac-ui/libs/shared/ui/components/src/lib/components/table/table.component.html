<table *ngIf="dataSource" class="mat-elevation-z8 table" [class.table--wrap]="wrap" mat-table matSort
       [matSortDisabled]="!sortable" [dataSource]="dataSource" multiTemplateDataRows (matSortChange)="onSort($event)">

  <!-- Expandable toggle -->
  <ng-container matColumnDef="_expandableToggle">
    <th class="table__cell" mat-header-cell *matHeaderCellDef></th>
    <td class="table__cell table__cell--expandable-toggle" mat-cell *matCellDef="let element">
      <mat-icon *ngIf="element._expandData || element._nestedTableData"
                class="arrow"
                aria-hidden="false"
                aria-label="expand"
                (click)="expandedElement = expandedElement === element ? null : element">
        keyboard_arrow_right
      </mat-icon>
    </td>
  </ng-container>

  <!-- Data -->
  <ng-container *ngFor="let column of columns" [matColumnDef]="column.name">
    <th class="table__cell" mat-header-cell *matHeaderCellDef mat-sort-header>{{column.label}}</th>
    <td class="table__cell" mat-cell *matCellDef="let element">
      <div [ngSwitch]="element[column.name].type">
        <!-- Button -->
        <ng-container *ngSwitchCase="'button'">
          <button gu-button [type]=" element[column.name].buttonType ? element[column.name].buttonType : 'tertiary'"
                  size="extrasmall"
                  noPadding
                  (click)="onButtonClick(column.name, element[column.name].value)">
            {{ element[column.name].label }}
          </button>
        </ng-container>

        <!-- Icon -->
        <ng-container *ngSwitchCase="'icon'">
          <mat-icon class="icon"
                    [ngClass]="(element[column.name].iconColor ? 'icon--' + element[column.name].iconColor : '')">
            {{element[column.name].label}}
          </mat-icon>
        </ng-container>

        <!-- Link -->
        <ng-container *ngSwitchCase="'link'">
          <a class="anchor" [href]="element[column.name].url"
             target="{{ element[column.name].target || '_self' }}">{{ element[column.name].label }}</a>
        </ng-container>

        <!-- Text -->
        <ng-template ngSwitchDefault>
          {{element[column.name].label}}
        </ng-template>
      </div>
    </td>
  </ng-container>

  <!-- Expendable Data -->
  <ng-container matColumnDef="_expandedIndent">
    <td class="table__cell" mat-cell *matCellDef="let element"></td>
  </ng-container>

  <ng-container matColumnDef="_expandedDetail">
    <td class="table__cell" mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length - 1">
      <div class="table__nested-content"
           [class.table__nested-content--expanded]="element == expandedElement"
           [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
        {{ element._expandData }}
        <gu-table [table]="element._nestedTableData" (buttonOutput)="onNestedButtonClick($event)"></gu-table>
      </div>
    </td>
  </ng-container>

  <!-- Header row -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

  <!-- Data rows -->
  <tr class="table__row table__row--expandable"
      [class.table__row--expanded]="expandedElement === element"
      [class.table__row--interactive]="tableOutput.observers.length"
      mat-row
      *matRowDef="let element; columns: displayedColumns;"
      (click)="onRowClick(element._clickOutput);"></tr>

  <!-- Expanded data rows -->
  <tr class="table__row table__row--expanded-content" mat-row
      *matRowDef="let row; columns: ['_expandedIndent', '_expandedDetail']">
  </tr>
</table>
