<form [ngClass]="{'form': true, 'form--toggle': editable==='toggle', 'form--edit': edit}" [formGroup]="formGroup"
      (ngSubmit)="_formSubmit()" (mouseenter)="isHovered = true" (mouseleave)="isHovered = false">
  <button gu-button class="form__edit-toggle" buttonStyle="tertiary" size="extrasmall" icon="edit"
          (click)="toggleClick($event)" *ngIf="isToggleable()">
    {{edit ? 'Annuleren' : 'Bewerken' }}
  </button>

  <h2 *ngIf="title">{{ title }}</h2>

  <fieldset class="form__body">
    <div *ngFor="let field of fields; let i = index">
      <div [hidden]="!isExpanded && i >= 4 + this.hiddenFields.length && !edit && showLess">
        <!-- Document -->
        <div *ngIf="field.widgetType == 'document'" class="form__document mb-4">
          <!-- Has document -->
          <div *ngIf="field.value" class="row">
            <div class="col-12">
              <p class="p--bold d-inline">Document:&nbsp;</p>
              <a class="anchor" (click)="onDocumentClick(field.value.readUrl)">{{field.value.titel}}</a>
            </div>
          </div>

          <!-- Selected document -->
          <div *ngIf="documents[field.name]" class="row">
            <p class="col-8 mb-4">Document: {{documents[field.name]?.bestandsnaam}}</p>
            <p class="col-4 mb-4">
              <button gu-button
                      buttonStyle="tertiary"
                      icon="remove"
                      size="extrasmall"
                      type="button"
                      (click)="removeDocument(field)">
                Documentkoppeling verwijderen
              </button>
            </p>

          </div>

          <!-- Allow select -->
          <div *ngIf="!documents[field.name]" class="row">
            <div class="col-12 mb-4">
              <button *ngIf="field.widgetType == 'document'"
                      gu-button
                      buttonStyle="tertiary"
                      icon="upload_file"
                      size="extrasmall"
                      type="button"
                      (click)="field.edit = !field.edit">
                {{field.value
                ? 'Wijzigen'
                : field.edit
                  ? 'Annuleren'
                  : field.label
                }}
              </button>

              <gu-document-toevoegen *ngIf="field.edit"
                                     [zaak]="zaak"
                                     (uploadedDocument)="onUploadedDocument(field, $event)"
                                     title=""
                                     description=""
                                     submitLabel="Toevoegen">
              </gu-document-toevoegen>
            </div>
          </div>
        </div>

        <!-- Read-only field. -->
        <div class="row" *ngIf="field.widgetType == 'readonly' && !field.writeonly">
          <div class="col-12">
            <p class="p--bold mb-0">{{field.label}}</p>
          </div>

          <div class="col-12" *ngIf="!field.choices">
            <p class="p--pre-wrap" *ngIf="field.value" [innerHTML]="field.value|urlize:'_blank'"></p>
            <p class="p--pre-wrap" *ngIf="!field.value && field.placeholder"><em>{{field.placeholder}}</em></p>
          </div>


          <div class="col-12" *ngIf="field.choices">
            <p class="mt-2">
              <gu-chip color="tertiary">{{field.control.value}}</gu-chip>
            </p>
          </div>
        </div>
        <!-- End read-only field. -->

        <!-- Regular field. -->
        <gu-input
          *ngIf="field.widgetType == 'input' && edit"
          [control]="field.control"
          [label]="field.label"
          [maxlength]="field.maxlength"
          [pattern]="field.pattern || null"
          [placeholder]="field.placeholder"
          [type]="field.type"
          [required]="field.required"
          [value]="field.control.value"
          [autocomplete]="field.autocomplete"
          (change)="inputChanged($event, field)"
          class="mb-4"
        ></gu-input>
        <!-- End regular field. -->

        <!-- Select field. -->
        <gu-multiselect
          *ngIf="['checkboxGroup', 'select'].indexOf(field.widgetType) > -1 && edit"
          [control]="field.control"
          [items]="field.choices"
          [selectedValue]="field.control.value"
          [label]="field.label"
          [multiple]="field.multiple"
          [required]="field.required"
          [widgetType]="field.widgetType"
          bindLabel="label"
          bindValue="value"
          (change)="selectChanged($event, field)"
          (search)="selectSearch($event, field)"
          class="mb-4"
        ></gu-multiselect>
        <!-- End select field. -->
      </div>
    </div>
  </fieldset>

  <div class="d-flex justify-content-end">
    <button gu-button
            *ngIf="showLess && visibleFields?.length > 4 && !edit"
            type="button"
            buttonStyle="tertiary"
            size="extrasmall"
            [icon]="isExpanded ? 'unfold_less' : 'unfold_more'"
            (click)="isExpanded = !isExpanded">
      {{isExpanded ? 'Toon minder' : 'Toon meer'}}
    </button>
  </div>

  <footer class="form__footer">
    <button *ngIf="edit" gu-button type="submit" buttonStyle="primary" [size]="buttonSize" class="d-inline-block"
            [disabled]="!formGroup?.valid || isLoading" [loading]="isLoading">
      {{buttonLabel}}
    </button>
  </footer>
</form>

