<form [ngClass]="{'form': true, 'form--toggle': editable==='toggle', 'form--edit': edit}" [formGroup]="formGroup" (ngSubmit)="_formSubmit()" (mouseenter)="isHovered = true" (mouseleave)="isHovered = false">
  <button gu-button class="form__edit-toggle" buttonStyle="tertiary" size="extrasmall" icon="edit" (click)="toggleClick($event)" *ngIf="isToggleable()">
    {{edit ? 'Annuleren' : 'Bewerken' }}
  </button>

  <h2 *ngIf="title">{{ title }}</h2>

  <fieldset class="form__body">
    <div *ngFor="let field of fields; let i = index">
      <div [hidden]="!isExpanded && i >= 4 + this.hiddenFields.length && !edit">
        <!-- Read-only field. -->
        <div class="row" *ngIf="field.widgetType == 'readonly' && !field.writeonly">
          <div class="col-12">
            {{link}}
            <p class="p--bold mb-0" *ngIf="!link">{{field.label}}</p>
            <a class="anchor" target="_blank" *ngIf="link" href="{{field.value}}">{{field.label}}</a>
          </div>

          <div class="row" *ngIf="field.widgetType == 'readonly' && link && !field.writeonly">
            <div class="col-12">
              <a class="anchor" target="_blank" *ngIf="link" href="{{field.value}}">{{field.label}}</a>
            </div>
          </div>

          <div class="col-12" *ngIf="!field.choices">
            <p class="p--pre-wrap " *ngIf="field.value" [innerHTML]="field.value|urlize:'_blank'"></p>
            <p class="p--pre-wrap " *ngIf="!field.value && field.placeholder"><em>{{field.placeholder}}</em></p>
          </div>


          <div class="col-12" *ngIf="field.choices">
            <p class="mt-2">
              <gu-chip color="tertiary">{{field.control.value}}</gu-chip>
            </p>
          </div>
        </div>
        <!-- End read-only field. -->

        <!-- Regular field. -->
        <gu-input
          *ngIf="field.widgetType == 'input'"
          [control]="field.control"
          [label]="field.label"
          [pattern]="field.pattern || null"
          [placeholder]="field.placeholder"
          [type]="field.type"
          [required]="field.required"
          [value]="field.control.value"
          [autocomplete]="field.autocomplete"
          (change)="inputChanged($event, field)"
          class="mb-4"
        ></gu-input>
        <!-- End regular field. -->

        <!-- Select field. -->
        <gu-multiselect
          *ngIf="field.widgetType == 'select' && edit"
          [control]="field.control"
          [items]="field.choices"
          [selectedValue]="field.control.value"
          [label]="field.label"
          [multiple]="field.multiple"
          [required]="field.required"
          bindLabel="label"
          bindValue="value"
          (change)="selectChanged($event, field)"
          (search)="selectSearch($event, field)"
          class="mb-4"
        ></gu-multiselect>
        <!-- End select field. -->
      </div>
    </div>
  </fieldset>

  <div class="d-flex justify-content-end">
    <button gu-button
            *ngIf="showLess && visibleFields?.length > 4 && !edit"
            type="button"
            buttonStyle="tertiary"
            size="extrasmall"
            [icon]="isExpanded ? 'unfold_less' : 'unfold_more'"
            (click)="isExpanded = !isExpanded">
      {{isExpanded ? 'Toon minder' : 'Toon meer'}}
    </button>
  </div>

  <footer class="form__footer">
    <button *ngIf="edit" gu-button type="submit" buttonStyle="primary" [size]="buttonSize" class="d-inline-block" [disabled]="!formGroup.valid || isLoading" [loading]="isLoading">
      {{buttonLabel}}
    </button>
  </footer>
</form>

