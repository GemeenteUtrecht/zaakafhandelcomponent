<!--  Loading -->
<gu-loading-indicator *ngIf="isLoading"></gu-loading-indicator>

<section *ngIf="!isLoading" class="row m-0">
  <div class="col-xl-10 p-0">
    <div class="feature-container pb-0">
      <div class="content-background mb-0">
        <article class="content">

          <!-- Breadcrumb -->
          <a class="anchor anchor--back mb-4" routerLink="/zaken">Alle zaken</a>


          <!-- Header -->
          <section class="row">
            <header class="col-12 d-flex" *ngIf="zaakData">
              <h1>{{zaakData.zaaktype.omschrijving}}</h1>

              <button gu-button
                      buttonStyle="tertiary"
                      size="extrasmall"
                      class="ml-2 p-0"
                      *ngIf="activeActivities"
                      (click)="openModal('activities-modal')">

                <span>
                  <gu-chip icon="launch" [color]="'primary'" [ngPlural]="activeActivities?.length">
                      <ng-template ngPluralCase="0">Activiteit toevoegen</ng-template>
                      <ng-template ngPluralCase="1">{{activeActivities?.length}} activiteit actief</ng-template>
                      <ng-template ngPluralCase="other">{{activeActivities?.length}} activiteiten actief</ng-template>
                  </gu-chip>
                </span>
              </button>
            </header>
          </section>


          <!-- Error and 403 access request -->
          <section *ngIf="hasError && errorMessage" class="row">
            <div class="col-lg-6">
              <gu-message *ngIf="!isSubmittingAccessRequest" [type]="!isAccessRequestSuccess ? 'warn' : 'success'"
                          [message]="!isAccessRequestSuccess ? errorMessage : accessRequestSuccessMessage"
                          class="d-block mb-4"></gu-message>

              <div *ngIf="canRequestAccess && !isAccessRequestSuccess">
                <h2>Toegang vragen tot deze zaak</h2>

                <gu-input [control]="commentControl"
                          type="text"
                          label="Opmerking"
                          class="mb-4">
                </gu-input>

                <button gu-button
                        (click)="onSubmitAccessRequest()"
                        [disabled]='isSubmittingAccessRequest'
                        [loading]='isSubmittingAccessRequest'>
                  Aanvraag versturen
                </button>
              </div>
            </div>
          </section>

          <!-- Components -->
          <section *ngIf="!isLoading && !hasError" class="row" >

            <!-- Left column -->
            <div class="col-4">


              <!-- I don't know what this does -->
              <div *ngIf="zaakData?.resultaat" class="card card--accent">
                <p class="p--marginsmall">Resultaat: </p>
                <h4 [ngClass]="{
                  'mb-0': !zaakData.resultaat.toelichting
                }">
                  {{zaakData.resultaat.resultaattype.omschrijving}}</h4>
                <p class="p--marginsmall"
                   *ngIf="zaakData.resultaat.toelichting">{{zaakData.resultaat.toelichting}}</p>
              </div>


              <!-- Details -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-informatie *ngIf="zaakData" [bronorganisatie]="bronorganisatie" [identificatie]="identificatie">
                  <gu-betrokkenen [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-betrokkenen>
                </gu-informatie>
              </aside>


              <!-- Related cases -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-gerelateerde-zaken [mainZaakUrl]="mainZaakUrl" [bronorganisatie]="bronorganisatie"
                                       [identificatie]="identificatie"></gu-gerelateerde-zaken>
              </aside>


              <!-- User permissions -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-user-permissions [bronorganisatie]="bronorganisatie"
                                     [identificatie]="identificatie"></gu-user-permissions>
              </aside>
            </div>


            <!-- Right column -->
            <div class="col-8">

              <!-- Status -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-status [bronorganisatie]="bronorganisatie"
                           [identificatie]="identificatie"
                           [progress]="zaakData.deadlineProgress"
                           [deadline]="zaakData.deadline"
                           [finished]="!!zaakData.resultaat"></gu-status>
              </aside>


              <!-- Processes -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-keten-processen *ngIf="currentUser"
                                    [mainZaakUrl]="mainZaakUrl"
                                    [currentUser]="currentUser"
                                    [bronorganisatie]="bronorganisatie"
                                    [identificatie]="identificatie"
                                    (update)="ketenProcessenUpdate($event)"
                                    class="zaak-detail__section">
                </gu-keten-processen>
              </aside>


              <!-- Approval -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-adviseren-accorderen [bronorganisatie]="bronorganisatie"
                                         [identificatie]="identificatie"></gu-adviseren-accorderen>
              </aside>


              <!-- Related objects -->
              <aside *ngIf="zaakData" class="mb-4">
                <gu-gerelateerde-objecten [bronorganisatie]="bronorganisatie"
                                          [identificatie]="identificatie"></gu-gerelateerde-objecten>
              </aside>


              <aside *ngIf="zaakData" class="">
                <gu-documenten [mainZaakUrl]="mainZaakUrl"
                               [bronorganisatie]="bronorganisatie"
                               [identificatie]="identificatie"
                               class="zaak-detail__section">
                </gu-documenten>
              </aside>
            </div>
          </section>


        </article>

        <!-- Modals -->
        <gu-modal [closeIcon]="true" id="add-person-modal" title="Toegang verlenen" size="small">
          <gu-toegang-verlenen [mainZaakUrl]="mainZaakUrl" [identificatie]="identificatie"></gu-toegang-verlenen>
        </gu-modal>

        <gu-modal *ngIf="mainZaakUrl" [closeIcon]="true" id="activities-modal">
          <gu-activiteiten *ngIf="currentUser && activityData"
                           [mainZaakUrl]="mainZaakUrl"
                           [bronorganisatie]="bronorganisatie"
                           [identificatie]="identificatie"
                           [currentUser]="currentUser"
                           [activityData]="activityData">
          </gu-activiteiten>
        </gu-modal>
      </div>
    </div>
  </div>

  <!-- Map -->
  <aside *ngIf="!isLoading && !hasError" class="gu-features-zaak-detail__sidebar col-xl-2 p-0">
    <gu-zaak-map [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-zaak-map>
  </aside>
</section>
