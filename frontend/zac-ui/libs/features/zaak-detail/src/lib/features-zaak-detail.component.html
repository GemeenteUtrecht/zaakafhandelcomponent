<!--  Loading -->
<gu-loading-indicator *ngIf="isLoading"></gu-loading-indicator>

<section *ngIf="!isLoading" class="row m-0 flex-nowrap">
  <div class="flex-fill p-0">
    <div class="feature-container">
      <div class="content-background mb-0" [ngClass]="(zaakData?.resultaat ? 'content-background--yellow' : '')">
        <article class="content">

          <!-- Breadcrumb -->
          <a class="anchor anchor--back mb-4" [routerLink]="['/zoeken']">Zaken zoeken</a>


          <!-- Header -->
          <section class="row">
            <header class="col-12" *ngIf="zaakData">
              <h1 class="mb-2">{{zaakData.zaaktype.omschrijving}}</h1>
              <div class="mb-4">
                <gu-chip color="tertiary" class="mr-2">{{zaakData.identificatie}}</gu-chip>
                <p class="p d-inline-block mb-0">{{zaakData.omschrijving}}</p>
              </div>

              <gu-message *ngIf="zaakData.resultaat" class="d-block mb-2" type="primary">
                <p class="mb-2">Deze zaak is afgesloten.</p>
                <p class="mb-2">Resultaat: <strong>{{zaakData.resultaat.resultaattype.omschrijving}}</strong></p>
                <p *ngIf="zaakData.resultaat.toelichting" class="mb-2">Toelichting: {{zaakData.resultaat.toelichting}}</p>
              </gu-message>
            </header>
          </section>


          <!-- Error and 403 access request -->
          <section *ngIf="hasError && errorMessage" class="row">
            <div class="col-lg-6">
              <gu-message *ngIf="!isSubmittingAccessRequest" [type]="!isAccessRequestSuccess ? 'warn' : 'success'"
                          [message]="!isAccessRequestSuccess ? errorMessage : accessRequestSuccessMessage"
                          class="d-block mb-4"></gu-message>

              <!-- Hide if case is closed and the user is not allowed to force edit -->
              <div *ngIf="canRequestAccess && !isAccessRequestSuccess && (!zaakData.resultaat || zaakData.kanGeforceerdBijwerken)">
                <h2>Toegang vragen tot deze zaak</h2>

                <gu-input [control]="commentControl"
                          type="text"
                          label="Opmerking"
                          class="mb-4">
                </gu-input>

                <button gu-button
                        (click)="onSubmitAccessRequest()"
                        [disabled]='isSubmittingAccessRequest'
                        [loading]='isSubmittingAccessRequest'>
                  Aanvraag versturen
                </button>
              </div>
            </div>
          </section>

          <!-- Components -->
          <section *ngIf="!isLoading && !hasError && zaakData">
            <nav mat-tab-nav-bar>
              <a mat-tab-link *ngFor="let tab of tabs; index as i"
                 [href]="getTabLink(tab.link)"
                 (click)="$event.preventDefault(); setUrl(tab.link); activeLink = tab.link"
                 [active]="activeLink === tab.link">
                {{tab.title}}
                <gu-chip *ngIf="tab.link === 'acties' && nTasks"
                         type="badge"
                         color="primary"
                         class="ml-1">
                  {{nTasks}}
                </gu-chip>
              </a>
            </nav>

            <div class="pt-4 pb-4 pl-2 pr-2">

              <!-- Overview tab -->

              <div class="row" [hidden]="activeLink !== 'overzicht'">
                <div class="col-lg-7 mb-lg-4">
                  <!-- Information -->
                  <gu-informatie class="d-block mb-4" [zaak]="zaakData">
                  </gu-informatie>

                  <!-- Related cases -->
                  <gu-gerelateerde-zaken [zaak]="zaakData"></gu-gerelateerde-zaken>
                </div>
                <div class="col-lg-5">
                  <!-- Involved persons -->
                  <gu-betrokkenen class="d-block mb-4" [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-betrokkenen>

                  <!-- User permissions -->
                  <gu-user-permissions [zaak]="zaakData"></gu-user-permissions>
                </div>
              </div>

              <!-- Acties tab -->

              <div class="row" [hidden]="activeLink !== 'acties'">
                <div class="col-lg-7 mb-4">
                  <!-- Processes -->
                  <gu-keten-processen *ngIf="currentUser"
                                      [mainZaakUrl]="mainZaakUrl"
                                      [currentUser]="currentUser"
                                      [bronorganisatie]="bronorganisatie"
                                      [identificatie]="identificatie"
                                      [zaak]="zaakData"
                                      (update)="ketenProcessenUpdate($event)"
                                      (nTaskDataEvent)="nTasks = $event"
                                      class="zaak-detail__section">
                  </gu-keten-processen>
                </div>

                <div class="col-lg-5">
                  <gu-status class="d-block mb-4"
                             [zaak]="zaakData"
                             [progress]="zaakData.deadlineProgress"
                             [deadline]="zaakData.deadline"
                             [finished]="!!zaakData.resultaat">
                  </gu-status>

                  <!-- Approval -->
                  <gu-adviseren-accorderen [bronorganisatie]="bronorganisatie"
                                           [identificatie]="identificatie">
                  </gu-adviseren-accorderen>
                </div>
              </div>

              <!-- TAB: Documenten -->

              <div class="row" [hidden]="activeLink !== 'documenten'">
                <div class="col-lg-12 mb-lg-4">
                  <gu-documenten [zaak]="zaakData" class="zaak-detail__section"></gu-documenten>
                </div>
              </div>

              <!-- Objects tab -->

              <div class="row" [hidden]="activeLink !== 'objecten'">
                <div class="col-lg-7 mb-4">
                  <gu-gerelateerde-objecten [zaak]="zaakData"></gu-gerelateerde-objecten>
                </div>

                <div class="col-lg-5" *ngIf="!isLoading && !hasError">
                  <gu-zaak-map [bronorganisatie]="bronorganisatie"
                               [identificatie]="identificatie"
                  ></gu-zaak-map>
                </div>
              </div>
            </div>

          </section>
        </article>

        <!-- Modals -->
        <gu-modal [closeIcon]="true" id="add-person-modal" title="Toegang verlenen" size="small">
          <gu-toegang-verlenen [zaak]="zaakData"></gu-toegang-verlenen>
        </gu-modal>

        <!-- Hide if case is closed and the user is not allowed to force edit -->
        <gu-modal *ngIf="mainZaakUrl && (!zaakData.resultaat || zaakData.kanGeforceerdBijwerken)" [closeIcon]="true" id="activities-modal">
          <gu-activiteiten *ngIf="currentUser && activityData"
                           [zaak]="zaakData"
                           [currentUser]="currentUser"
                           [activityData]="activityData">
          </gu-activiteiten>
        </gu-modal>
      </div>
    </div>
  </div>

</section>
