<!--  Loading -->
<gu-loading-indicator *ngIf="isLoading"></gu-loading-indicator>

<section *ngIf="!isLoading" class="row m-0 flex-nowrap">
  <div class="flex-fill p-0">
    <div class="feature-container">
      <div class="content-background mb-0" [ngClass]="(zaakData?.resultaat ? 'content-background--yellow' : '')">
        <article class="content">

          <!-- Breadcrumb -->
          <a class="anchor anchor--back mb-4" [routerLink]="['/zoeken']">Zaken zoeken</a>


          <!-- Header -->
          <section class="row">
            <header class="col-12 d-flex" *ngIf="zaakData">
              <h1>{{zaakData.zaaktype.omschrijving}}</h1>
            </header>
          </section>


          <!-- Error and 403 access request -->
          <section *ngIf="hasError && errorMessage" class="row">
            <div class="col-lg-6">
              <gu-message *ngIf="!isSubmittingAccessRequest" [type]="!isAccessRequestSuccess ? 'warn' : 'success'"
                          [message]="!isAccessRequestSuccess ? errorMessage : accessRequestSuccessMessage"
                          class="d-block mb-4"></gu-message>

              <div *ngIf="canRequestAccess && !isAccessRequestSuccess">
                <h2>Toegang vragen tot deze zaak</h2>

                <gu-input [control]="commentControl"
                          type="text"
                          label="Opmerking"
                          class="mb-4">
                </gu-input>

                <button gu-button
                        (click)="onSubmitAccessRequest()"
                        [disabled]='isSubmittingAccessRequest'
                        [loading]='isSubmittingAccessRequest'>
                  Aanvraag versturen
                </button>
              </div>
            </div>
          </section>

          <!-- Components -->
          <section *ngIf="!isLoading && !hasError">
            <gu-tab-group>

              <!-- Case details -->
              <gu-tab label="Overzicht">
                <div class="pt-4 pb-4 pl-2 pr-2">
                  <div class="row">
                    <div class="col-lg-7 mb-lg-4">
                      <!-- Information -->
                      <gu-informatie class="d-block mb-4"
                                     *ngIf="zaakData"
                                     [mainZaakUrl]="mainZaakUrl"
                                     [bronorganisatie]="bronorganisatie"
                                     [identificatie]="identificatie"
                                     [zaaktypeOmschrijving]="zaakData.zaaktype?.omschrijving">
                      </gu-informatie>

                      <!-- Related cases -->
                      <gu-gerelateerde-zaken [mainZaakUrl]="mainZaakUrl" [bronorganisatie]="bronorganisatie"
                                             [identificatie]="identificatie"></gu-gerelateerde-zaken>
                    </div>
                    <div class="col-lg-5">
                      <!-- Involved persons -->
                      <gu-betrokkenen class="d-block mb-4" [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-betrokkenen>

                      <!-- User permissions -->
                      <gu-user-permissions [bronorganisatie]="bronorganisatie"
                                           [identificatie]="identificatie"></gu-user-permissions>
                    </div>
                  </div>
                </div>
              </gu-tab>

              <!-- Acties -->
              <gu-tab label="Acties">
                <div class="pt-4 pb-4 pl-2 pr-2">
                  <div class="row">
                    <div class="col-lg-7 mb-4">
                      <!-- Processes -->
                        <gu-keten-processen *ngIf="currentUser"
                                            [mainZaakUrl]="mainZaakUrl"
                                            [currentUser]="currentUser"
                                            [bronorganisatie]="bronorganisatie"
                                            [identificatie]="identificatie"
                                            [zaak]="zaakData"
                                            (update)="ketenProcessenUpdate($event)"
                                            class="zaak-detail__section">
                        </gu-keten-processen>
                    </div>

                    <div class="col-lg-5">
                      <gu-status class="d-block mb-4"
                                 [mainZaakUrl]="mainZaakUrl"
                                 [bronorganisatie]="bronorganisatie"
                                 [identificatie]="identificatie"
                                 [progress]="zaakData.deadlineProgress"
                                 [deadline]="zaakData.deadline"
                                 [finished]="!!zaakData.resultaat">
                      </gu-status>

                      <!-- Approval -->
                      <gu-adviseren-accorderen [bronorganisatie]="bronorganisatie"
                                               [identificatie]="identificatie">
                      </gu-adviseren-accorderen>
                    </div>
                  </div>
                </div>
              </gu-tab>

              <!-- Documenten -->
              <gu-tab label="Documenten">
                <div class="pt-4 pb-4 pl-2 pr-2">
                  <div class="row">
                    <div class="col-lg-12 mb-lg-4">
                      <gu-documenten [mainZaakUrl]="mainZaakUrl"
                                     [zaaktypeurl]="zaakData.zaaktype.url"
                                     [bronorganisatie]="bronorganisatie"
                                     [identificatie]="identificatie"
                                     class="zaak-detail__section">
                      </gu-documenten>
                    </div>
                  </div>
                </div>
              </gu-tab>

              <!-- Objecten -->
              <gu-tab label="Objecten">
                <div class="pt-4 pb-4 pl-2 pr-2">
                  <div class="row">
                    <div class="col-lg-8 mb-4">
                      <gu-gerelateerde-objecten [bronorganisatie]="bronorganisatie"
                                                [identificatie]="identificatie">
                      </gu-gerelateerde-objecten>
                    </div>
                  </div>
                  <div>
                    <div *ngIf="!isLoading && !hasError">
                      <gu-zaak-map [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-zaak-map>
                    </div>
                  </div>
                </div>
              </gu-tab>
            </gu-tab-group>
          </section>
        </article>

        <!-- Modals -->
        <gu-modal [closeIcon]="true" id="add-person-modal" title="Toegang verlenen" size="small">
          <gu-toegang-verlenen [mainZaakUrl]="mainZaakUrl" [identificatie]="identificatie"></gu-toegang-verlenen>
        </gu-modal>

        <gu-modal *ngIf="mainZaakUrl" [closeIcon]="true" id="activities-modal">
          <gu-activiteiten *ngIf="currentUser && activityData"
                           [mainZaakUrl]="mainZaakUrl"
                           [bronorganisatie]="bronorganisatie"
                           [identificatie]="identificatie"
                           [currentUser]="currentUser"
                           [activityData]="activityData">
          </gu-activiteiten>
        </gu-modal>
      </div>
    </div>
  </div>

  <!-- Map -->
<!--  <gu-collapse [collapsed]="true">-->
<!--    <aside *ngIf="!isLoading && !hasError">-->
<!--      <gu-zaak-map [bronorganisatie]="bronorganisatie" [identificatie]="identificatie"></gu-zaak-map>-->
<!--    </aside>-->
<!--  </gu-collapse>-->
</section>
